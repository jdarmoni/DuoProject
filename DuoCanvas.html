<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="Duo.css">
    <title>Gamedev Canvas Workshop</title>
    <style>
    	* { padding: 0; margin: 0; }
    	canvas { background: #eee; display: block; margin: 0 auto; }
    </style>
</head>
<body>
    <div class="header"> Duolingo! Translate <span class="word">"Oeuf"</span> </div>

<canvas id="myCanvas" width="960" height="640"></canvas>

<script>
    window.onload = function(){
        
        var canvas = document.getElementById('myCanvas');
        var ctx = canvas.getContext('2d');
        var sprite = new Image();
            sprite.src = "https://d7mj4aqfscim2.cloudfront.net/images/owl-sprite20.svg";
        var falling = false;
        var speed = 5;
        var jump = 5
        var duo = {sx: 15, sy: 15, sWidth: 250, sHeight: 300, dx: 0, dy: canvas.height - 90, dWidth: 75, dHeight: 100 }
     
        var rightPressed = false;
        var leftPressed = false;
        var upPressed = false;
        var downPressed = false;
        var ticker = 0;

        // PLATFORMS
        var platform = {x: 450, y: canvas.height-200, height: 200, width: 200}
        var terrace = {x: 0, y: 100, height: 50, width: 200 }
                    
        // ******* Dark Duos ******/
        // var DarkDuo = {sx: 610, sy: 300, dx: canvas.width, dy: canvas.height}
                
        sprite.onload = function(){            
            ctx.drawImage(sprite, duo.sx, duo.sy, duo.sWidth, duo.sHeight, duo.dx, duo.dy, duo.dWidth, duo.dHeight);
        }

    function spriteify() {
        if (falling === false) {

            if (duo.sx === 15 ) {
                duo.sx = 340;
            } else if (duo.sx === 340 ) {
                duo.sx = 15;
            } 
        }
    }
    function drawPlatform() {
            ctx.beginPath();
            ctx.rect(platform.x, platform.y, platform.width, platform.height);
            ctx.fillStyle = "black";
            ctx.fill();
            ctx.closePath();
        }

    function drawTerrace(){
        ctx.beginPath();
        ctx.rect(terrace.x, terrace.y, terrace.width, terrace.height)
        ctx.fillStyle = "black";
        ctx.fill();
        ctx.closePath();
    }

    // need two collision detections - they both need to know this range, though.
    function collisionDetection(object){
        //   if duo's x position + speed goes into the object
        if ( duo.dx + speed > object.x - duo.dWidth && (duo.dx + speed < object.x + object.width)) {
                if ( ( (duo.dy + duo.dHeight) + jump >= object.y) && (duo.dy + jump <= object.y + object.height) ) {
                    console.log('X PROBLEM')
                    return true
                }
        }
    }
    
    
    function YcollisionDetection(object) {
            // if he's colliding horizontally, he should still be able to jump and move the opposite way

            if  ( ((duo.dx > object.x - duo.dWidth) && (duo.dx < object.x + object.width) )  && ( ( (duo.dy + duo.dHeight) + jump >= object.y) && (duo.dy + jump <= object.y + object.height)) ) {
                    console.log("Duo's Y:")
                    console.log(duo.dy)
                    console.log(object.y)    
                    return true
                }
            
        }

    function XcollisionDetection(object) {
            
            // if a movement would enter him into between x (start) AND the x+width (MAX LENGTH) of object
            if ( (duo.dx + speed > object.x - duo.dWidth && (duo.dx + speed < object.x + object.width))  && ( ((duo.dy + duo.dHeight) >= object.y) && (duo.dy <= object.y + object.height)) ) {
                // AND
                                                                                                                  // if it would enter him into between y (start) AND y + height (end) range of the object
                  console.log("Duo's X:")
                // console.log(duo.yx)
                // console.log(object.y)    
                    return true // it's true that he would be colliding
                
            }
            //QUESTION: how to express, if moving left would collide with platform the X Y of platform
        }
   
        function draw() {
            ctx.clearRect(duo.dx, duo.dy, duo.dWidth, duo.dHeight);
            drawPlatform();
            drawTerrace();
            XcollisionDetection(platform);
            YcollisionDetection(platform)
            // XcollisionDetection(platform);
            // YcollisionDetection(platform);
        
            // keypress
            // calculate new position
            // is that position valid

            // ctx.drawImage(sprite, dDsx, dDsy, sWidth, sHeight, Ddx, Ddy, dWidth, dHeight)

            if (rightPressed && ( duo.dx + duo.dWidth< canvas.width) ) {
                if (XcollisionDetection(platform) === true ){
                    console.log('right button problem')
                    duo.dx -= 10
                } else {
                    duo.dx += speed;
                }
            }
            if (leftPressed && duo.dx > 0) {
                if (XcollisionDetection(platform)===true){
                    console.log('left button problem')
                    duo.dx += 10
                } else {
                    duo.dx -= speed;
                }
            }
            if (upPressed && duo.dy > 0) {
                duo.dy -= jump;
            }
            if ( (upPressed === false && duo.dy < canvas.height) && (duo.dy + duo.dHeight < canvas.height) ) {
                // falling = true;
                if (YcollisionDetection(platform)===true) {
                    duo.dy += 0;
                } else {
                    duo.dy += jump;
                } 
            }
            // if (upPressed === false && duo.dy < canvas.height) {falling = false}
            ctx.drawImage(sprite, duo.sx, duo.sy, duo.sWidth, duo.sHeight, duo.dx, duo.dy, duo.dWidth, duo.dHeight);

    }

    document.addEventListener("keydown", keyDownHandler, false);
    document.addEventListener("keyup", keyUpHandler, false);

    function keyDownHandler(e) {
        if (e.key == "Right" || e.key == "ArrowRight") {
            rightPressed = true;
        }
        else if (e.key == "Left" || e.key == "ArrowLeft") {
            leftPressed = true;
        } 
        else if (e.key == "Up" || e.key == "ArrowUp") {
            upPressed = true;
        }
        else if (e.key == "Down" || e.key == "ArrowDown") {
            downPressed = true;
        }
    }

    function keyUpHandler(e) {
        if (e.key == "Right" || e.key == "ArrowRight") {
            rightPressed = false;
        }
        else if (e.key == "Left" || e.key == "ArrowLeft") {
            leftPressed = false;
        }
        else if (e.key == "Up" || e.key =="ArrowUp") {
            upPressed = false;
        }
        else if (e.key == "Down" || e.key == "ArrowDown") {
            downPressed = false;
        }
    }

    // function collisionDetection() {
    //         for (var c = 0; c < brickColumnCount; c++) {
    //             for (var r = 0; r < brickRowCount; r++) {
    //                 var b = bricks[c][r];
    //                 if (x > b.x && x < b.x + brickWidth && y > b.y && y < b.y + brickHeight) {
    //                     dy = -dy;
    //                 }
    //             }
    //         }
    //     }
    
    setInterval(draw, 15)
    setInterval(spriteify, 750)
}

</script>

</body>
</html>